class Util{forEach(e,t){e=e||[];for(let i=0;i<e.length;i++)t(e[i])}getScrollTop(){return document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}isMobile(){return window.matchMedia("only screen and (max-width: 680px)").matches}isTocStatic(){return window.matchMedia("only screen and (max-width: 960px)").matches}animateCSS(e,t,i,s){Array.isArray(t)||(t=[t]),e.classList.add("animated",...t);const n=()=>{e.classList.remove("animated",...t),e.removeEventListener("animationend",n),"function"==typeof s&&s()};i||e.addEventListener("animationend",n,!1)}}class Theme{constructor(){this.config=window.config,this.data=this.config.data,this.isDark="dark"===document.body.getAttribute("theme"),this.util=new Util,this.newScrollTop=this.util.getScrollTop(),this.oldScrollTop=this.newScrollTop,this.scrollEventSet=new Set,this.resizeEventSet=new Set,this.switchThemeEventSet=new Set,this.clickMaskEventSet=new Set,window.objectFitImages&&objectFitImages()}initSVGIcon(){this.util.forEach(document.querySelectorAll("[data-svg-src]"),e=>{fetch(e.getAttribute("data-svg-src")).then(e=>e.text()).then(t=>{const i=document.createElement("div");i.insertAdjacentHTML("afterbegin",t);const s=i.firstChild;s.setAttribute("data-svg-src",e.getAttribute("data-svg-src")),s.classList.add("icon");const n=s.getElementsByTagName("title");n.length&&s.removeChild(n[0]),e.parentElement.replaceChild(s,e)}).catch(e=>{console.error(e)})})}initTwemoji(){this.config.twemoji&&twemoji.parse(document.body)}initMenuMobile(){const e=document.getElementById("menu-toggle-mobile"),t=document.getElementById("menu-mobile");e.addEventListener("click",()=>{document.body.classList.toggle("blur"),e.classList.toggle("active"),t.classList.toggle("active")},!1),this._menuMobileOnClickMask=this._menuMobileOnClickMask||(()=>{e.classList.remove("active"),t.classList.remove("active")}),this.clickMaskEventSet.add(this._menuMobileOnClickMask)}initSwitchTheme(){this.util.forEach(document.getElementsByClassName("theme-switch"),e=>{e.addEventListener("click",()=>{"dark"===document.body.getAttribute("theme")?document.body.setAttribute("theme","light"):document.body.setAttribute("theme","dark"),this.isDark=!this.isDark,window.localStorage&&localStorage.setItem("theme",this.isDark?"dark":"light");for(let e of this.switchThemeEventSet)e();location.reload()},!1)})}initSearch(){const e=this.config.search,t=this.util.isMobile();if(!e||t&&this._searchMobileOnce||!t&&this._searchDesktopOnce)return;const i=e.maxResultLength?e.maxResultLength:10,s=e.snippetLength?e.snippetLength:50,n=e.highlightTag?e.highlightTag:"em",o=t?"mobile":"desktop",a=document.getElementById(`header-${o}`),l=document.getElementById(`search-input-${o}`),c=document.getElementById(`search-toggle-${o}`),r=document.getElementById(`search-loading-${o}`),h=document.getElementById(`search-clear-${o}`);t?(this._searchMobileOnce=!0,l.addEventListener("focus",()=>{document.body.classList.add("blur"),a.classList.add("open")},!1),document.getElementById("search-cancel-mobile").addEventListener("click",()=>{a.classList.remove("open"),document.body.classList.remove("blur"),document.getElementById("menu-toggle-mobile").classList.remove("active"),document.getElementById("menu-mobile").classList.remove("active"),r.style.display="none",h.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},!1),h.addEventListener("click",()=>{h.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},!1),this._searchMobileOnClickMask=this._searchMobileOnClickMask||(()=>{a.classList.remove("open"),r.style.display="none",h.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")}),this.clickMaskEventSet.add(this._searchMobileOnClickMask)):(this._searchDesktopOnce=!0,c.addEventListener("click",()=>{document.body.classList.add("blur"),a.classList.add("open"),l.focus()},!1),h.addEventListener("click",()=>{h.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")},!1),this._searchDesktopOnClickMask=this._searchDesktopOnClickMask||(()=>{a.classList.remove("open"),r.style.display="none",h.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")}),this.clickMaskEventSet.add(this._searchDesktopOnClickMask)),l.addEventListener("input",()=>{""===l.value?h.style.display="none":h.style.display="inline"},!1);const d=()=>{const a=autocomplete(`#search-input-${o}`,{hint:!1,autoselect:!0,dropdownMenuContainer:`#search-dropdown-${o}`,clearOnSelected:!0,cssClasses:{noPrefix:!0},debug:!0},{name:"search",source:(t,o)=>{r.style.display="inline",h.style.display="none";const a=e=>{r.style.display="none",h.style.display="inline",o(e)};if("lunr"===e.type){const o=()=>{lunr.queryHandler&&(t=lunr.queryHandler(t));const e={};return this._index.search(t).forEach(({ref:t,matchData:{metadata:i}})=>{const o=this._indexData[t];let{uri:a,title:l,content:c}=o;if(e[a])return;let r=0;Object.values(i).forEach(({content:e})=>{if(e){const t=e.position[0][0];(t<r||0===r)&&(r=t)}}),(r-=s/5)>0?(r+=c.substr(r,20).lastIndexOf(" ")+1,c="..."+c.substr(r,s)):c=c.substr(0,s),Object.keys(i).forEach(e=>{l=l.replace(new RegExp(`(${e})`,"gi"),`<${n}>$1</${n}>`),c=c.replace(new RegExp(`(${e})`,"gi"),`<${n}>$1</${n}>`)}),e[a]={uri:a,title:l,date:o.date,context:c}}),Object.values(e).slice(0,i)};this._index?a(o()):fetch(e.lunrIndexURL).then(e=>e.json()).then(t=>{const i={};this._index=lunr(function(){e.lunrLanguageCode&&this.use(lunr[e.lunrLanguageCode]),this.ref("objectID"),this.field("title",{boost:50}),this.field("tags",{boost:20}),this.field("categories",{boost:20}),this.field("content",{boost:10}),this.metadataWhitelist=["position"],t.forEach(e=>{i[e.objectID]=e,this.add(e)})}),this._indexData=i,a(o())}).catch(e=>{console.error(e),a([])})}else"algolia"===e.type&&(this._algoliaIndex=this._algoliaIndex||algoliasearch(e.algoliaAppID,e.algoliaSearchKey).initIndex(e.algoliaIndex),this._algoliaIndex.search(t,{offset:0,length:8*i,attributesToHighlight:["title"],attributesToSnippet:[`content:${s}`],highlightPreTag:`<${n}>`,highlightPostTag:`</${n}>`}).then(({hits:e})=>{const t={};e.forEach(({uri:e,date:i,_highlightResult:{title:s},_snippetResult:{content:n}})=>{t[e]&&t[e].context.length>n.value||(t[e]={uri:e,title:s.value,date:i,context:n.value})}),a(Object.values(t).slice(0,i))}).catch(e=>{console.error(e),a([])}))},templates:{suggestion:({title:e,date:t,context:i})=>`<div><span class="suggestion-title">${e}</span><span class="suggestion-date">${t}</span></div><div class="suggestion-context">${i}</div>`,empty:({query:t})=>`<div class="search-empty">${e.noResultsFound}: <span class="search-query">"${t}"</span></div>`,footer:({})=>{const{searchType:t,icon:i,href:s}="algolia"===e.type?{searchType:"algolia",icon:'<i class="fab fa-algolia fa-fw"></i>',href:"https://www.algolia.com/"}:{searchType:"Lunr.js",icon:"",href:"https://lunrjs.com/"};return`<div class="search-footer">Search by <a href="${s}" rel="noopener noreffer" target="_blank">${i} ${t}</a></div>`}}});a.on("autocomplete:selected",(e,t,i,s)=>{window.location.assign(t.uri)}),t?this._searchMobile=a:this._searchDesktop=a};if(e.lunrSegmentitURL&&!document.getElementById("lunr-segmentit")){const t=document.createElement("script");t.id="lunr-segmentit",t.type="text/javascript",t.src=e.lunrSegmentitURL,t.async=!0,t.readyState?t.onreadystatechange=(()=>{"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onreadystatechange=null,d())}):t.onload=(()=>{d()}),document.body.appendChild(t)}else d()}initDetails(){this.util.forEach(document.getElementsByClassName("details"),e=>{e.getElementsByClassName("details-summary")[0].addEventListener("click",()=>{e.classList.toggle("open")},!1)})}initLightGallery(){this.config.lightGallery&&lightGallery(document.getElementById("content"),this.config.lightGallery)}initHighlight(){this.util.forEach(document.querySelectorAll(".highlight > pre.chroma"),e=>{const t=document.createElement("div");t.className=e.className;const i=document.createElement("table");t.appendChild(i);const s=document.createElement("tbody");i.appendChild(s);const n=document.createElement("tr");s.appendChild(n);const o=document.createElement("td");n.appendChild(o),e.parentElement.replaceChild(t,e),o.appendChild(e)}),this.util.forEach(document.querySelectorAll(".highlight > .chroma"),e=>{const t=e.querySelectorAll("pre.chroma > code");if(t.length){const i=t[t.length-1],s=document.createElement("div");s.className="code-header "+i.className.toLowerCase();const n=document.createElement("span");n.classList.add("code-title"),n.insertAdjacentHTML("afterbegin",'<i class="arrow fas fa-chevron-right fa-fw"></i>'),n.addEventListener("click",()=>{e.classList.toggle("open")},!1),s.appendChild(n);const o=document.createElement("span");o.insertAdjacentHTML("afterbegin",'<i class="fas fa-ellipsis-h fa-fw"></i>'),o.classList.add("ellipses"),o.addEventListener("click",()=>{e.classList.add("open")},!1),s.appendChild(o);const a=document.createElement("span");a.insertAdjacentHTML("afterbegin",'<i class="far fa-copy fa-fw"></i>'),a.classList.add("copy");const l=i.innerText;if((this.config.code.maxShownLines<0||l.split("\n").length<this.config.code.maxShownLines+2)&&e.classList.add("open"),this.config.code.copyTitle){a.setAttribute("data-clipboard-text",l),a.title=this.config.code.copyTitle,new ClipboardJS(a).on("success",e=>{this.util.animateCSS(i,"flash")}),s.appendChild(a)}e.insertBefore(s,e.firstChild)}})}initTable(){this.util.forEach(document.querySelectorAll(".content table"),e=>{const t=document.createElement("div");t.className="table-wrapper",e.parentElement.replaceChild(t,e),t.appendChild(e)})}initHeaderLink(){for(let e=1;e<=6;e++)this.util.forEach(document.querySelectorAll(".single .content > h"+e),e=>{e.classList.add("headerLink"),e.insertAdjacentHTML("afterbegin",`<a href="#${e.id}" class="header-mark"></a>`)})}initToc(){const e=document.getElementById("TableOfContents");if(null!==e)if(this.util.isTocStatic()){const t=document.getElementById("toc-content-static");e.parentElement!==t&&(e.parentElement.removeChild(e),t.appendChild(e)),this._tocOnScroll&&this.scrollEventSet.delete(this._tocOnScroll)}else{const t=document.getElementById("toc-content-auto");e.parentElement!==t&&(e.parentElement.removeChild(e),t.appendChild(e));const i=document.getElementById("toc-auto"),s=document.getElementsByClassName("page")[0],n=s.getBoundingClientRect();i.style.left=`${n.left+n.width+20}px`,i.style.maxWidth=`${s.getBoundingClientRect().left-20}px`,i.style.visibility="visible";const o=e.querySelectorAll("a:first-child"),a=e.getElementsByTagName("li"),l=document.getElementsByClassName("headerLink"),c="normal"!==document.body.getAttribute("header-desktop"),r=document.getElementById("header-desktop").offsetHeight,h=20+(c?r:0),d=i.offsetTop,m=d-h+(c?0:r);this._tocOnScroll=this._tocOnScroll||(()=>{const t=document.getElementById("post-footer").offsetTop-i.getBoundingClientRect().height,s=t-h+(c?0:r);this.newScrollTop<m?(i.style.position="absolute",i.style.top=`${d}px`):this.newScrollTop>s?(i.style.position="absolute",i.style.top=`${t}px`):(i.style.position="fixed",i.style.top=`${h}px`),this.util.forEach(o,e=>{e.classList.remove("active")}),this.util.forEach(a,e=>{e.classList.remove("has-active")});const n=20+(c?r:0);let u=l.length-1;for(let e=0;e<l.length-1;e++){const t=l[e].getBoundingClientRect().top,i=l[e+1].getBoundingClientRect().top;if(0==e&&t>n||t<=n&&i>n){u=e;break}}if(-1!==u){o[u].classList.add("active");let t=o[u].parentElement;for(;t!==e;)t.classList.add("has-active"),t=t.parentElement.parentElement}}),this._tocOnScroll(),this.scrollEventSet.add(this._tocOnScroll)}}initMath(){this.config.math&&renderMathInElement(document.body,this.config.math)}initMermaid(){const e=document.getElementsByClassName("mermaid");e.length&&(mermaid.initialize({startOnLoad:!1,theme:"null"}),this.util.forEach(e,e=>{mermaid.mermaidAPI.render("svg-"+e.id,this.data[e.id],t=>{e.insertAdjacentHTML("afterbegin",t)},e)}))}initEcharts(){this._echartsOnSwitchTheme=this._echartsOnSwitchTheme||(()=>{this._echartsArr=this._echartsArr||[];for(let e=0;e<this._echartsArr.length;e++)this._echartsArr[e].dispose();this._echartsArr=[],this.util.forEach(document.getElementsByClassName("echarts"),e=>{const t=echarts.init(e,this.isDark?"dark":"macarons",{renderer:"svg"});t.setOption(JSON.parse(this.data[e.id])),this._echartsArr.push(t)})}),this.switchThemeEventSet.add(this._echartsOnSwitchTheme),this._echartsOnSwitchTheme(),this._echartsOnResize=this._echartsOnResize||(()=>{for(let e=0;e<this._echartsArr.length;e++)this._echartsArr[e].resize()}),this.resizeEventSet.add(this._echartsOnResize)}initMapbox(){this.config.mapbox&&(mapboxgl.accessToken=this.config.mapbox.accessToken,mapboxgl.setRTLTextPlugin(this.config.mapbox.RTLTextPlugin),this._mapboxArr=this._mapboxArr||[],this.util.forEach(document.getElementsByClassName("mapbox"),e=>{const{lng:t,lat:i,zoom:s,lightStyle:n,darkStyle:o,marked:a,navigation:l,geolocate:c,scale:r,fullscreen:h}=this.data[e.id],d=new mapboxgl.Map({container:e,center:[t,i],zoom:s,minZoom:.2,style:this.isDark?o:n,attributionControl:!1});a&&(new mapboxgl.Marker).setLngLat([t,i]).addTo(d),l&&d.addControl(new mapboxgl.NavigationControl,"bottom-right"),c&&d.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showUserLocation:!0,trackUserLocation:!0}),"bottom-right"),r&&d.addControl(new mapboxgl.ScaleControl),h&&d.addControl(new mapboxgl.FullscreenControl),d.addControl(new MapboxLanguage),this._mapboxArr.push(d)}),this._mapboxOnSwitchTheme=this._mapboxOnSwitchTheme||(()=>{this.util.forEach(this._mapboxArr,e=>{const t=e.getContainer(),{lightStyle:i,darkStyle:s}=this.data[t.id];e.setStyle(this.isDark?s:i),e.addControl(new MapboxLanguage)})}),this.switchThemeEventSet.add(this._mapboxOnSwitchTheme))}initTypeit(){if(this.config.typeit){const e=this.config.typeit,t=e.speed?e.speed:100,i=e.cursorSpeed?e.cursorSpeed:1e3,s=e.cursorChar?e.cursorChar:"|";Object.values(e.data).forEach(n=>{const o=a=>{const l=n[a],c=new TypeIt(`#${l}`,{strings:this.data[l],speed:t,lifeLike:!0,cursorSpeed:i,cursorChar:s,waitUntilVisible:!0,afterComplete:()=>{a!==n.length-1?(c.destroy(),o(a+1)):e.duration>=0&&window.setTimeout(()=>{c.destroy()},e.duration)}}).go()};o(0)})}}initComment(){if(this.config.comment){if(this.config.comment.gitalk){this.config.comment.gitalk.body=decodeURI(window.location.href),new Gitalk(this.config.comment.gitalk).render("gitalk")}if(this.config.comment.valine&&new Valine(this.config.comment.valine),this.config.comment.utterances){const e=this.config.comment.utterances,t=document.createElement("script");t.src="https://utteranc.es/client.js",t.type="text/javascript",t.setAttribute("repo",e.repo),t.setAttribute("issue-term",e.issueTerm),e.label&&t.setAttribute("label",e.label),t.setAttribute("theme",this.isDark?e.darkTheme:e.lightTheme),t.crossOrigin="anonymous",t.async=!0,document.getElementById("utterances").appendChild(t),this._utterancesOnSwitchTheme=this._utterancesOnSwitchTheme||(()=>{const t={type:"set-theme",theme:this.isDark?e.darkTheme:e.lightTheme};document.querySelector(".utterances-frame").contentWindow.postMessage(t,"https://utteranc.es")}),this.switchThemeEventSet.add(this._utterancesOnSwitchTheme)}}}initSmoothScroll(){SmoothScroll&&new SmoothScroll('[href^="#"]',{speed:300,speedAsDuration:!0,header:"#header-desktop"})}initCookieconsent(){this.config.cookieconsent&&cookieconsent.initialise(this.config.cookieconsent)}onScroll(){const e=[];if("auto"===document.body.getAttribute("header-desktop")&&e.push(document.getElementById("header-desktop")),"auto"===document.body.getAttribute("header-mobile")&&e.push(document.getElementById("header-mobile")),document.getElementById("comments")){const e=document.getElementById("view-comments");e.href="#comments",e.style.display="block"}const t=document.getElementById("fixed-buttons");window.addEventListener("scroll",()=>{this.newScrollTop=this.util.getScrollTop();const i=this.newScrollTop-this.oldScrollTop;this.util.forEach(e,e=>{i>20?(e.classList.remove("fadeInDown"),this.util.animateCSS(e,["fadeOutUp","faster"],!0)):i<-20&&(e.classList.remove("fadeOutUp"),this.util.animateCSS(e,["fadeInDown","faster"],!0))}),this.newScrollTop>20?i>20?(t.classList.remove("fadeIn"),this.util.animateCSS(t,["fadeOut","faster"],!0)):i<-20&&(t.style.display="block",t.classList.remove("fadeOut"),this.util.animateCSS(t,["fadeIn","faster"],!0)):t.style.display="none";for(let e of this.scrollEventSet)e();this.oldScrollTop=this.newScrollTop},!1)}onResize(){window.addEventListener("resize",()=>{this._resizeTimeout||(this._resizeTimeout=window.setTimeout(()=>{this._resizeTimeout=null;for(let e of this.resizeEventSet)e();this.initToc(),this.initMermaid(),this.initSearch()},100))},!1)}onClickMask(){document.getElementById("mask").addEventListener("click",()=>{for(let e of this.clickMaskEventSet)e();document.body.classList.remove("blur")},!1)}init(){this.initSVGIcon(),this.initTwemoji(),this.initMenuMobile(),this.initSwitchTheme(),this.initSearch(),this.initDetails(),this.initLightGallery(),this.initHighlight(),this.initTable(),this.initHeaderLink(),this.initToc(),this.initComment(),this.initSmoothScroll(),this.initMath(),this.initMermaid(),this.initEcharts(),this.initTypeit(),this.initMapbox(),this.initCookieconsent(),this.onScroll(),this.onResize(),this.onClickMask()}}const themeInit=()=>{(new Theme).init()};"loading"!==document.readyState?themeInit():document.addEventListener("DOMContentLoaded",themeInit,!1);
